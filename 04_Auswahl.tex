\chapter{Auswahl eines Frameworks}

\section{Migrationspfade}
Sowohl die einzelnen Frameworks als auch die Kombination mehrerer Frameworks haben jeweils
spezifische Vor- und Nachteile. Im Folgenden werden sowohl der vollständige Umstieg auf ein
bestimmtes Framework als auch Kombinationen mehrerer Frameworks vorgestellt und bewertet.

\subsection{Vollständige Migration zu Prototype}
Da Prototype bereits in einingen Bereichen von Indico integriert ist, muss es nur global
eingebunden werden; Konflikte sind dabei eher unwahrscheinlich. Danach muss der Code nach und nach
vom alten System auf Prototype umgestellt werden - dies bedeutet, dass alle ca. 240 Klassen in der
Struktur angepasst werden müssen und sofern Mehrfachvererbung genutzt auch redesignt werden müssen,
sodass sie das Objektsystem von Prototype nutzen können. Um die Erzeugung von HTML auf Prototype
umzustellen, müssen die ca. 2000 Aufrufe von \lstinline{Html.*}-Funktionen angepasst werden und da
der \lstinline{XElement}-Wrapper wegfällt alle darauf aufbauenden Funktionen modifiziert werden. Da
JSON-RPC-Aufrufe in Indico über eine zentrale Funktion laufen, kann diese relativ einfach auf die
AJAX-Funktionen vno Prototype umgestellt werden. Bei der Migration von Hilfsfunktionen wie
\lstinline{each()} oder \lstinline{curry()} kann aufgrund der größtenteils identischen Parametern
mit \emph{Search\&Replace} eines modernen Editors gearbeitet werden oder es können unter den alten
Funktionsnamen Wrapper bereitgestellt werden, sodass dabei nur wenige Codestellen geändert werden
müssen. Eine größere Hürde bei der Migration ist das \emph{Data Binding}-Framework von Indico. Da
Prototype keine derartige Funktionalität beinhaltet muss dieses unter Verwendung moderner
JavaScript-Technologien neu entwickelt werden.

Abschließend kann man sagen, dass es sich bei dieser Migration um ein extrem aufwändiges und
zeitintensives Unterfangen handelt, was aber am Ende zu sauberem Code führen würde, der sowohl
leicht wartbar wäre als auch für neue Entwickler einen einfachen Einstieg ermöglichen würde.


\subsection{Vollständige Migration zu jQuery + Classy}
Um jQuery zu benutzen, muss es zunächst global eingebunden werden und dabei auftretende Konflikte
behoben werden. Dazu sollte Prototype möglichst früh entfernt und Prototype-basierter Code angepasst
werden, was aufgrund der ähnlichen Paradigmen der beiden Frameworks relativ einfach möglich ist.
Da jQuery kein Objektsystem besitzt, Indico aber weiterhin objektorientiert aufgebaut sein soll,
wird neben jQuery die Classy-Bibliothek eingebunden. Wie Prototype unterstützt allerdings auch
Classy nur eine echte Parent-Klasse und Mixin-Objekte, weshalb ein Redesign der Objektstruktur von
Indico notwendig wird. Bei der Migration der DOM-Zugriff und -Manipulationen kann entweder einfach
auf jQuery gewechselt werden oder aber die Codestruktur angepasst werden, sodass der Code die
Vorteile von jQuery vollständig ausnutzt - beispielsweise durch \emph{Method Chaining} und die
Nutzung von Komfortfunktionen wie \lstinline{wrap()} und \lstinline{closest()}. Die funktionalen
Hilfsfunktionen können teilweise direkt durch jQuery-Äquivalente ersetzt werden - dabei reicht es
oftmals aus, \lstinline{func} durch \lstinline{$.func} zu ersetzen; diverse in jQuery nicht
vorhandenen Funktionen müssen dabei neu implementiert werden, sofern sie nicht unabhängig vom
restlichen Indico-Framework funktionsfähig sind. jQuery unterstützt leider genau wie Prototype kein
\emph{Data Binding}, weshalb dort eine Eigenentwicklung notwendig ist. Allerdings bietet jQuery
durch \lstinline{val([newValue])} eine Methode um den Wert eines formularelements auszulesen und zu
ändern - an einigen Stellen könnte man diese Funktion an ein bestimmtes Element binden und als
\emph{Accessor} an eine andere Funktion übergeben - wenn man diese Funktionen in einem Objekt
speichert hat man ein sauberes Interface zum Zugriff auf die Werte und Änderungen wirken sich
logischerweise direkt auf das zugehörige Formularelement aus.

Der Komplettumstieg auf jQuery ist genau wie der Umstieg auf Prototype sehr aufwändig und
zeitintensiv, führt aber ebenfalls zu sauberem und gut wartbarem Code. Da jQuery derzeit eines der
beliebtesten Frameworks ist, besteht darüberhinaus eine große Chance, dass ein neuer Entwickler
bereits Erfahrung damit hat.


\subsection{Vollständige Migration auf jQuery und Prototype}
Theoretisch wäre es möglich, sowohl jQuery als auch Prototype einzubinden, wobei in diesem Fall die
\lstinline{$}-Funktion von jQuery unter einem anderen Namen - beispielswiese \lstinline{$j} -
aufgerufen werden müsste, da Prototype ebenfalls \lstinline{$} nutzt. Da beide Frameworks einen
ähnlichen Funktionsumfang besitzen gibt es keinen sinnvollen Grund, beide zu benutzen.


\subsection{Teilweise Migration auf Prototype}
Neben der vollständigen Migration auf ein Framework besteht auch die Möglichkeit, das bestehende
Framework vorerst beizubehalten und nur durch Prototype zu erweitern, was ja dadurch, dass einige
Seiten teilweise Prototype nutzen, bereits der Fall ist. Neben der globalen Einbindung von Prototype
werden dabei Teile von Indico auf Prototype umgestellt, wo es sich besonders anbietet. Ein solcher
Teil ist das Eventsystem - für die Umstellung muss lediglich der Code des Indico-Frameworks
bearbeitet werden; daneben bietet es sich an, die Hilfsmethoden zum browserunabhängigen Zugriff auf
bestimmte Eigenschaften des Eventobjekts zu entfernen, sofern Prototype diese bereits normalisiert.
Ein weiterer Bereich, in dem die Umstellung auf Prototype sinnvoll ist, ist Drag\&Drop - teilweise
wird dort sogar schon Prototype genutzt. Bei Hilfsfunktionen, die sowohl im Indico-Framework als
auch in Prototype mit derselben \emph{Signatur}, d.h. denselben Aufrufparametern und demselben
Rückgabedatentyp, existieren, bietet es sich an, diese Funktionen aus Indico zu entfernen und
entweder alle Aufrufe selbiger zu ändern, sodass die Prototype-Funktion benutzt wird, oder eine
Variable mit demselben Namen wie alten Funktion zu definieren und darin eine Referenz auf die
Prototype-Funktion zu speichern. DOM-Zugriff bieten sich ebenfalls zum Migrieren an, allerdings muss
dabei der Aufwand mit dem Nutzen verglichen werden - es gibt über 1200 Aufrufe der
\lstinline{$E}-Funktion, wobei danach oftmals noch \lstinline{XElement}-Methoden verwendet werden.
Diese müssten alle angepasst werden. Dasselbe gilt für die über 2000 Aufrufe der
\lstinline{Html.*}-Funktionen zur Erstellung neuer DOM-Elemente. Unabhängig davon, ob man diesen
Bereich migriert oder nicht sollte neuer Code ausschließlich Prototype nutzen, sodass die Verwendung
der alten Funktionen nicht zunimmt. Durch das Beibebalten der alten Funktionen ist es jedoch
notwendig, dass neuer Code überprüft, ob es sich bei einem Objekt bereits um ein
(Prototype-erweitertes) DOM-Element handelt oder um ein \lstinline{XElement}-Objekt und in letzterem
Fall durch \lstinline{$(obj.dom)} das enthaltene DOM-Element mit den Prototype-spezifischen
Erweiterungen versieht und dieses statt des Wrappers benutzt.

Bei der Erweiterung des bestehenden Frameworks durch Prototype lässt sich viel Entwicklungszeit
einsparen, da man nicht so gut wie jede Klasse umschreiben muss und bestehenden Code größtenteils
weiterverwenden kann. Indem man neuen Code ausschließlich auf Prototype aufbauen lässt verbessert
sich die Codequalität im Laufe der Zeit automatisch; dies lässt sich noch beschleunigen wenn jeder
Entwickler, der bestehenden Code modifiziert, diesen auf Prototype umstellt. Durch die Mischung von
altem und neuem Code ist die Gesamtqualität des Codes natürlich schlechter, ermöglicht Entwicklern
aber dennoch effizient zu arbeiten, da sie bei der Entwicklung neuer Funktionen größtenteils sauber
dokumentierte Funktionen nutzen können und nur in Fällen, wo ausschließlich Legacy-Code existiert,
sich in diesen einlesen müssen.


\subsection{Teilweise Migration auf jQuery}
Statt das bereits vorhandene Prototype zu nutzen besteht auch die Möglichkeit, jQuery zum
bestehenden Code hinzuzufügen und diesen damit zu erweitern. Dabei sollte wie auch bei der
vollständigen Migration Prototype möglichst früh entfernt werden, um den Konflikt zwischen den
beiden Frameworks aufzulösen - da Prototype derzeit primär für einige Events und Drag\&Drop genutzt
wird ist der betroffene Code einfach zu migrieren, da Events durch jQuery selbst und Drag\&Drop
durch jQuery UI unterstützt werden. Danach ist zu überprüfen, welche Teile von Indico auf jQuery
umgestellt werden sollten und welche nicht. Das Eventsystem kann zwar relativ einfach umgestellt
werden, allerdings bietet es sich dort an, den bestehenden Code nicht zu verändern sondern nur in
neuem Code jQuery zur Eventregistrierung zu nutzen, sodass man die Vorteile von jQuery vollständig
nutzen kann statt die jQuery-Methoden in den vorhandenen Funktionen einzubauen, die beispielsweise
kein \emph{Chaining} ermöglichen. Da jQuery UI ein Dialog-Widget enthält sollte die Dialogklasse von
Indico auf jeden Fall angepasst werden um dieses Widget zu nutzen. Dabei ist es sinnvoll, die
Kompatibilität mit bestehendem Code möglichst beizubehalten, da diese Klasse eine der am häufigsten
genutzen Klassen in ganz Indico ist. Neben den Dialogen ist es auch sinnvoll, das Tab-Widget zu
nutzen, da Tabs oftmals innerhalb von Dialogen verwendet werden und ein einheitliches Aussehen
erwünscht ist. Bei der Migration von DOM-Zugriffen ist wie auch beim Umstieg auf Prototype der
Aufwand mit dem Nutzen zu vergleichen. Ebenfalls zu beachten ist die Kompatibilität mit bestehenden
Funktionen: Eine Funktion, die jQuery nutzt, muss überprüfen, ob es sich bei einem Objekt um ein
DOM-Element bzw. jQuery-Objeklt handelt oder ob ein \lstinline{XElement}-Wrapper übergeben wurde und
in diesem Fall mittels \lstinline{$(obj.dom);} das enthaltene Element in ein jQuery-Element
kopieren. Auch andersrum muss auf Kompatibilität geachtet werde, indem Funktionen keine
jQuery-Objekte sondern DOM-Objekte zurückgeben - dies ist dank des Arrayzugriffs auf jQuery-Objekte
jedoch problemlos möglich.

Indico durch jQuery zu erweitern hat neben dem im Vergleich zum Komplettmigration niedrigen
Entwicklungsaufawnd verschiedene Vorteile. Mit jeweils einer einzigen Zeile Code lässt sich die
Kompatibilität zwischen jQuery-basiertem Code und Legacy-Code gewährleisten, wodurch neuer Code ohne
Schwierigkeiten jQuery nutzen und gleichzeitig auf Legacy-Funktionen zugreifen kann - allerdings
bietet es sich in solchen Fällen an, zu überprüfen wie aufwändig es wäre, die Funktion auf jQuery
umzustellen. Ein weiterer Vorteil ist die große Menge an
jQuery-Plugins\footnote{\href{http://plugins.jquery.com}{http://plugins.jquery.com}} die - meist
unter einer mit der GPL kompatiblen Open Source-Lizenz - verfügbar sind und ohne ein Konflikt mit
bestehendem Code zu riskieren eingebunden werden können.



\subsection{Zusatz: Underscore.js}
Unabhängig davon, ob man komplett auf ein neues Framework umstellt oder das Indico-Framework
beibehält und nur durch ein anderes Framework erweitert - es existieren diverse HilfsFunktionen im
Indico-Framework, die dort unsauber oder unperformant implementiert sind, aber im neuen Framework
nicht vorhanden sind. Die Chance ist jedoch groß, dass eine äquivalente Funktion in der
Underscore.js-Bibliothek verfügbar ist. Der Nachteil dabei ist jedoch dass dadurch einige Funktionen
mehrfach verfügbar sind - zum einen in Prototype bzw. jQuery, zum anderen in Underscore.js. Daher
ist in diesem Fall auf eine entsprechende Dokumentation zu achten, sodass Entwickler wissen, welche
Funktion sie bevorzugen sollen, falls sie mehrfach vorhanden ist.


\todotext{Entscheidung}
